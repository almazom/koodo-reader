# Minimax Chapter Summarization - –ò–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏–æ–Ω–Ω—ã–π –ø–ª–∞–Ω

## –§–∞–∑—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

### –§–∞–∑–∞ 1: –ë–∞–∑–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (3-5 –¥–Ω–µ–π)

#### –î–µ–Ω—å 1: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
- [x] –°–æ–∑–¥–∞–Ω–∏–µ –≤–µ—Ç–∫–∏ `feature/minimax-chapter-summarization`
- [x] –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±—â–µ–≥–æ –ø–ª–∞–Ω–∞ –≤ `docs/features/minimax_chapter_summarization.md`
- [x] –°–æ–∑–¥–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞ –ø—Ä–æ–º–ø—Ç–æ–≤ –Ω–∞ —Ä—É—Å—Å–∫–æ–º `docs/features/minimax_default_prompts_ru.md`
- [x] –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö SQLite
- [ ] –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –∫–ª—é—á–µ–π API –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

#### –î–µ–Ω—å 2: –ë–∞–∑–æ–≤—ã–µ —Å–µ—Ä–≤–∏—Å—ã
- [ ] –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã LLM —Å–µ—Ä–≤–∏—Å–∞
  - [ ] –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ `LLMProvider`
  - [ ] –†–µ–∞–ª–∏–∑–∞—Ü–∏—è `MinimaxProvider`
  - [ ] –†–µ–∞–ª–∏–∑–∞—Ü–∏—è `LLMServiceManager` —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫
- [ ] –°–æ–∑–¥–∞–Ω–∏–µ —É—Ç–∏–ª–∏—Ç—ã –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ –≥–ª–∞–≤—ã
  - [ ] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã `htmlBook`
  - [ ] –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –º–µ—Ç–æ–¥–∞ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ –≥–ª–∞–≤—ã

#### –î–µ–Ω—å 3: –•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
- [ ] –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å–µ—Ä–≤–∏—Å–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–º–ø—Ç–∞–º–∏
  - [ ] –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–º–ø—Ç–æ–≤ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
  - [ ] –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –ø—Ä–æ–º–ø—Ç–æ–≤
  - [ ] –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–æ–≤
- [ ] –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å—É–º–º–∞—Ä–∏–∑–∞—Ü–∏–π
  - [ ] –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SQLite –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
  - [ ] –†–µ–∞–ª–∏–∑–∞—Ü–∏—è CRUD –æ–ø–µ—Ä–∞—Ü–∏–π –¥–ª—è —Å—É–º–º–∞—Ä–∏–∑–∞—Ü–∏–π

### –§–∞–∑–∞ 2: UI –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (2-3 –¥–Ω—è)

#### –î–µ–Ω—å 4: –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã UI
- [ ] –ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–ª–∞–≤–∞—é—â–µ–π –∫–Ω–æ–ø–∫–∏ AI
  - [ ] –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–µ–Ω—é –æ–ø—Ü–∏–π –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏
  - [ ] –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ–ø—Ü–∏–∏ —Å—É–º–º–∞—Ä–∏–∑–∞—Ü–∏–∏ –≥–ª–∞–≤—ã
- [ ] –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—É–º–º–∞—Ä–∏–∑–∞—Ü–∏–∏
  - [ ] –î–∏–∑–∞–π–Ω –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –∏–ª–∏ –ø–∞–Ω–µ–ª–∏
  - [ ] –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤ –∑–∞–≥—Ä—É–∑–∫–∏

#### –î–µ–Ω—å 5: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è UI –∏ —Å–µ—Ä–≤–∏—Å–æ–≤
- [ ] –°–≤—è–∑—ã–≤–∞–Ω–∏–µ UI —Å LLM —Å–µ—Ä–≤–∏—Å–æ–º
  - [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π –Ω–∞–∂–∞—Ç–∏—è –Ω–∞ –æ–ø—Ü–∏—é —Å—É–º–º–∞—Ä–∏–∑–∞—Ü–∏–∏
  - [ ] –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
  - [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ –≤—ã–≤–æ–¥ –ø–æ–Ω—è—Ç–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å–∏—Å—Ç–µ–º–æ–π —Ö—Ä–∞–Ω–µ–Ω–∏—è
  - [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å—É–º–º–∞—Ä–∏–∑–∞—Ü–∏–π
  - [ ] –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ —Å–æ–∑–¥–∞–Ω–∏—è —Å—É–º–º–∞—Ä–∏–∑–∞—Ü–∏–∏

### –§–∞–∑–∞ 3: –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (2-3 –¥–Ω—è)

#### –î–µ–Ω—å 6: –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- [ ] –°–æ–∑–¥–∞–Ω–∏–µ –ø–∞–Ω–µ–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
  - [ ] –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ API –∫–ª—é—á–∞–º–∏
  - [ ] –í—ã–±–æ—Ä –º–æ–¥–µ–ª–∏ (MiniMax-Text-01 –∏–ª–∏ DeepSeek-R1)
  - [ ] –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–≤–µ–¥–µ–Ω–∏—è –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- [ ] –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ –ø—Ä–æ–º–ø—Ç–æ–≤
  - [ ] –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ø—Ä–æ–º–ø—Ç–æ–≤
  - [ ] –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø—Ä–æ–º–ø—Ç–æ–≤
  - [ ] –°–±—Ä–æ—Å –¥–æ –∑–Ω–∞—á–µ–Ω–∏–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

#### –î–µ–Ω—å 7-8: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- [ ] –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
  - [ ] –ú–∏–Ω–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–¥–µ—Ä–∂–µ–∫ UI –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–∞—Ö –∫ API
  - [ ] –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Å—É–º–º–∞—Ä–∏–∑–∞—Ü–∏–π
- [ ] –¢—â–∞—Ç–µ–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
  - [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫
  - [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ —Ñ–æ—Ä–º–∞—Ç–∞–º–∏ –∫–Ω–∏–≥
  - [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –±–æ–ª—å—à–∏—Ö –≥–ª–∞–≤

## –î–µ—Ç–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### 1. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–ø–æ–∫ –∏ —Ñ–∞–π–ª–æ–≤

```
src/
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ llm/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ index.ts                     // –≠–∫—Å–ø–æ—Ä—Ç—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ llm-provider.interface.ts    // –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å LLMProvider
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ llm-service-manager.ts       // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ LLM —Å–µ—Ä–≤–∏—Å–∞–º–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ providers/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ minimax-provider.ts      // –†–µ–∞–ª–∏–∑–∞—Ü–∏—è Minimax
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ...                      // –ë—É–¥—É—â–∏–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ types.ts                     // –û–±—â–∏–µ —Ç–∏–ø—ã
‚îÇ   ‚îú‚îÄ‚îÄ chapter-extractor/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ index.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ chapter-extractor.ts         // –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –≥–ª–∞–≤—ã
‚îÇ   ‚îú‚îÄ‚îÄ summary-storage/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ index.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ summary-storage.ts           // SQLite —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ models.ts                    // –¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îî‚îÄ‚îÄ prompt-manager/
‚îÇ       ‚îú‚îÄ‚îÄ index.ts
‚îÇ       ‚îú‚îÄ‚îÄ prompt-manager.ts            // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞–º–∏
‚îÇ       ‚îú‚îÄ‚îÄ default-prompts/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ ru.json                  // –†—É—Å—Å–∫–∏–µ –ø—Ä–æ–º–ø—Ç—ã
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ en.json                  // –ê–Ω–≥–ª–∏–π—Å–∫–∏–µ –ø—Ä–æ–º–ø—Ç—ã (–≤ –±—É–¥—É—â–µ–º)
‚îÇ       ‚îî‚îÄ‚îÄ types.ts                     // –¢–∏–ø—ã –ø—Ä–æ–º–ø—Ç–æ–≤
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îú‚îÄ‚îÄ ai-assistant/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ index.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ai-floating-button.tsx       // –ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–ª–∞–≤–∞—é—â–µ–π –∫–Ω–æ–ø–∫–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ai-options-menu.tsx          // –ú–µ–Ω—é –æ–ø—Ü–∏–π
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ chapter-summary.tsx          // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—É–º–º–∞—Ä–∏–∑–∞—Ü–∏–∏
‚îÇ   ‚îî‚îÄ‚îÄ settings/
‚îÇ       ‚îú‚îÄ‚îÄ llm-settings.tsx             // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ LLM
‚îÇ       ‚îî‚îÄ‚îÄ prompt-editor.tsx            // –†–µ–¥–∞–∫—Ç–æ—Ä –ø—Ä–æ–º–ø—Ç–æ–≤
‚îî‚îÄ‚îÄ config/
    ‚îî‚îÄ‚îÄ llm-config.ts                    // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è LLM
```

### 2. –ú–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö SQLite

```sql
-- –°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
CREATE TABLE chapter_summaries (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    book_id TEXT NOT NULL,               -- –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∫–Ω–∏–≥–∏
    chapter_id TEXT NOT NULL,            -- –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –≥–ª–∞–≤—ã
    chapter_title TEXT NOT NULL,         -- –ß–∏—Ç–∞–µ–º–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≥–ª–∞–≤—ã
    model TEXT NOT NULL,                 -- –ò—Å–ø–æ–ª—å–∑—É–µ–º–∞—è –º–æ–¥–µ–ª—å (–Ω–∞–ø—Ä. "MiniMax-Text-01")
    prompt_id TEXT NOT NULL,             -- –°—Å—ã–ª–∫–∞ –Ω–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π —à–∞–±–ª–æ–Ω –ø—Ä–æ–º–ø—Ç–∞
    prompt_text TEXT NOT NULL,           -- –¢–µ–∫—Å—Ç –ø—Ä–æ–º–ø—Ç–∞
    summary TEXT NOT NULL,               -- –¢–µ–∫—Å—Ç —Å—É–º–º–∞—Ä–∏–∑–∞—Ü–∏–∏
    created_at INTEGER NOT NULL,         -- –í—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è (timestamp)
    tokens_used INTEGER NOT NULL,        -- –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤
    tokens_input INTEGER NOT NULL,       -- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—Ö–æ–¥–Ω—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤
    tokens_output INTEGER NOT NULL,      -- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—ã—Ö–æ–¥–Ω—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤
    language TEXT NOT NULL,              -- –Ø–∑—ã–∫ —Å—É–º–º–∞—Ä–∏–∑–∞—Ü–∏–∏
    UNIQUE(book_id, chapter_id, model, prompt_id)
);

CREATE INDEX idx_chapter_summaries_lookup ON chapter_summaries(book_id, chapter_id);
```

### 3. –ö–ª—é—á–µ–≤—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã

```typescript
// llm-provider.interface.ts
export interface LLMProvider {
  generateSummary(text: string, options: LLMOptions): Promise<SummaryResult>;
  checkAPIKey(): Promise<boolean>;
  getModelInfo(): LLMModelInfo;
  getAvailableModels(): string[];
}

// types.ts
export interface LLMOptions {
  model: string;
  prompt: PromptTemplate;
  maxTokens?: number;
  temperature?: number;
  language?: string;
}

export interface SummaryResult {
  summary: string;
  tokensUsed: number;
  tokensInput: number;
  tokensOutput: number;
  model: string;
  usedFallback?: boolean;
  originalModel?: string;
  fallbackModel?: string;
}

export interface LLMModelInfo {
  id: string;
  name: string;
  contextWindow: number;
  capabilities: string[];
  pricing?: {
    inputTokens: number;  // per 1M tokens
    outputTokens: number; // per 1M tokens
  };
}

// prompt-manager/types.ts
export interface PromptTemplate {
  id: string;
  name: string;
  system_message: string;
  user_template: string;
  parameters: {
    temperature: number;
    max_tokens: number;
    // –¥—Ä—É–≥–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –º–æ–¥–µ–ª–∏
  };
}
```

### 4. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –∫–æ–¥–æ–º

–ú—ã –±—É–¥–µ–º –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –∫–æ–¥–æ–º Koodo Reader —á–µ—Ä–µ–∑ —Å–ª–µ–¥—É—é—â–∏–µ —Ç–æ—á–∫–∏:

#### –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –≥–ª–∞–≤—ã

```typescript
// chapter-extractor.ts
export class ChapterExtractor {
  async extractCurrentChapter(htmlBook: HtmlBook): Promise<ChapterContent> {
    // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –º–µ—Ç–æ–¥—ã Koodo Reader –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–π –≥–ª–∞–≤—ã
    const rendition = htmlBook.rendition;
    const position = rendition.getPosition();
    const chapterIndex = position.chapterIndex;
    const chapterTitle = position.chapterTitle;
    const chapterId = htmlBook.flattenChapters[chapterIndex].id;
    
    // –ò–∑–≤–ª–µ–∫–∞–µ–º —Ç–µ–∫—Å—Ç –≥–ª–∞–≤—ã
    const content = await this.extractChapterText(rendition, chapterIndex);
    
    return {
      bookId: htmlBook.key,
      chapterId,
      chapterTitle,
      content,
      index: chapterIndex
    };
  }
  
  private async extractChapterText(rendition: any, chapterIndex: number): Promise<string> {
    // –ü–æ–ª—É—á–∞–µ–º –¥–æ–∫—É–º–µ–Ω—Ç –≥–ª–∞–≤—ã
    const chapterDoc = rendition.getChapterDoc()[chapterIndex];
    
    // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∏–º–µ—é—â–∏–µ—Å—è –º–µ—Ç–æ–¥—ã –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞
    // –ï—Å–ª–∏ –Ω–µ—Ç –ø—Ä—è–º–æ–≥–æ –º–µ—Ç–æ–¥–∞, –º–æ–∂–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å DOM –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è
    // —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞ –≥–ª–∞–≤—ã
    return this.extractTextFromDoc(chapterDoc);
  }
  
  private extractTextFromDoc(doc: any): string {
    // –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —á–∏—Å—Ç–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ –∏–∑ HTML –¥–æ–∫—É–º–µ–Ω—Ç–∞
    // –£–¥–∞–ª–µ–Ω–∏–µ –ª–∏—à–Ω–∏—Ö –ø—Ä–æ–±–µ–ª–æ–≤, —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —Ç.–¥.
    // ...
  }
}
```

#### –ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–ª–∞–≤–∞—é—â–µ–π –∫–Ω–æ–ø–∫–∏ AI

```typescript
// ai-floating-button.tsx
import React, { useState } from 'react';
import AiOptionsMenu from './ai-options-menu';

const AiFloatingButton: React.FC = () => {
  const [showOptions, setShowOptions] = useState(false);
  
  const handleClick = () => {
    setShowOptions(!showOptions);
  };
  
  return (
    <div className="ai-floating-button-container">
      <button 
        className="ai-floating-button" 
        onClick={handleClick}
      >
        AI
      </button>
      
      {showOptions && (
        <AiOptionsMenu onClose={() => setShowOptions(false)} />
      )}
    </div>
  );
};

export default AiFloatingButton;
```

```typescript
// ai-options-menu.tsx
import React from 'react';
import { useDispatch, useSelector } from 'react-redux';
import { Trans } from 'react-i18next';

interface AiOptionsMenuProps {
  onClose: () => void;
}

const AiOptionsMenu: React.FC<AiOptionsMenuProps> = ({ onClose }) => {
  const dispatch = useDispatch();
  const htmlBook = useSelector((state: any) => state.reader.htmlBook);
  
  const handleSummarizeChapter = () => {
    dispatch(actions.summarizeCurrentChapter(htmlBook));
    onClose();
  };
  
  return (
    <div className="ai-options-menu">
      <div className="ai-option" onClick={handleSummarizeChapter}>
        <span className="ai-option-icon">üìù</span>
        <span className="ai-option-text">
          <Trans>Summarize Chapter</Trans>
        </span>
      </div>
      
      {/* –î—Ä—É–≥–∏–µ –æ–ø—Ü–∏–∏ AI –≤ –±—É–¥—É—â–µ–º */}
      
      <div className="ai-option-close" onClick={onClose}>
        <Trans>Cancel</Trans>
      </div>
    </div>
  );
};

export default AiOptionsMenu;
```

### 5. Redux –¥–µ–π—Å—Ç–≤–∏—è –∏ —Ä–µ–¥—å—é—Å–µ—Ä—ã

```typescript
// actions.ts
export const summarizeCurrentChapter = (htmlBook) => async (dispatch, getState) => {
  try {
    dispatch({ type: 'CHAPTER_SUMMARY_REQUEST' });
    
    const state = getState();
    const llmConfig = state.config.llm;
    const llmService = new LLMServiceManager(llmConfig);
    const chapterExtractor = new ChapterExtractor();
    const summaryStorage = new SummaryStorage();
    const promptManager = new PromptManager();
    
    // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–π –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø—Ä–æ–º–ø—Ç
    const promptId = llmConfig.defaultPromptId || 'quick_summary';
    const prompt = promptManager.getPrompt(promptId);
    
    // –ò–∑–≤–ª–µ–∫–∞–µ–º —Ç–µ–∫—Å—Ç –≥–ª–∞–≤—ã
    const chapterContent = await chapterExtractor.extractCurrentChapter(htmlBook);
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ —Å—É–º–º–∞—Ä–∏–∑–∞—Ü–∏—è –≤ –∫—ç—à–µ
    const cachedSummary = await summaryStorage.getSummary(
      chapterContent.bookId,
      chapterContent.chapterId,
      promptId
    );
    
    if (cachedSummary) {
      dispatch({
        type: 'CHAPTER_SUMMARY_SUCCESS',
        payload: cachedSummary,
        fromCache: true
      });
      return;
    }
    
    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –Ω–æ–≤—É—é —Å—É–º–º–∞—Ä–∏–∑–∞—Ü–∏—é
    const summaryResult = await llmService.generateSummary(
      chapterContent.content,
      {
        model: llmConfig.model || 'MiniMax-Text-01',
        prompt,
        language: 'ru'
      }
    );
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    const summary = {
      bookId: chapterContent.bookId,
      chapterId: chapterContent.chapterId,
      chapterTitle: chapterContent.chapterTitle,
      model: summaryResult.model,
      promptId,
      promptText: JSON.stringify(prompt),
      summary: summaryResult.summary,
      createdAt: Date.now(),
      tokensUsed: summaryResult.tokensUsed,
      tokensInput: summaryResult.tokensInput,
      tokensOutput: summaryResult.tokensOutput,
      language: 'ru'
    };
    
    await summaryStorage.saveSummary(summary);
    
    dispatch({
      type: 'CHAPTER_SUMMARY_SUCCESS',
      payload: summary,
      fromCache: false
    });
  } catch (error) {
    dispatch({
      type: 'CHAPTER_SUMMARY_FAILURE',
      error: error.message
    });
  }
};

// reducer.ts
const initialState = {
  summary: null,
  loading: false,
  error: null,
  fromCache: false
};

export default function summaryReducer(state = initialState, action) {
  switch (action.type) {
    case 'CHAPTER_SUMMARY_REQUEST':
      return {
        ...state,
        loading: true,
        error: null
      };
    case 'CHAPTER_SUMMARY_SUCCESS':
      return {
        ...state,
        summary: action.payload,
        loading: false,
        error: null,
        fromCache: action.fromCache
      };
    case 'CHAPTER_SUMMARY_FAILURE':
      return {
        ...state,
        loading: false,
        error: action.error
      };
    default:
      return state;
  }
}
```

## –ü–ª–∞–Ω —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

1. **–Æ–Ω–∏—Ç-—Ç–µ—Å—Ç—ã**
   - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ –≥–ª–∞–≤—ã
   - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã —Å –ø—Ä–æ–º–ø—Ç–∞–º–∏
   - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ API

2. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã**
   - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –º–µ–∂–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏ UI –∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏
   - –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ —Å—É–º–º–∞—Ä–∏–∑–∞—Ü–∏–π

3. **–†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã —Å –∫–Ω–∏–≥–∞–º–∏ —Ä–∞–∑–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ API
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ –ø—Ä–æ–º–ø—Ç–∞–º–∏
   - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Å –¥–ª–∏–Ω–Ω—ã–º–∏ –≥–ª–∞–≤–∞–º–∏

## –†–∏—Å–∫–∏ –∏ –∏—Ö —Å–Ω–∏–∂–µ–Ω–∏–µ

1. **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è API**
   - –†–∏—Å–∫: –ü—Ä–µ–≤—ã—à–µ–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤ API –∏–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã —Å –¥–æ—Å—Ç—É–ø–æ–º
   - –°–Ω–∏–∂–µ–Ω–∏–µ: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞–¥–µ–∂–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ –∏ –º–µ—Ö–∞–Ω–∏–∑–º–∞ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫

2. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–ª–∏–Ω–Ω—ã—Ö –≥–ª–∞–≤**
   - –†–∏—Å–∫: –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –≥–ª–∞–≤—ã –º–æ–≥—É—Ç –ø—Ä–µ–≤—ã—à–∞—Ç—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
   - –°–Ω–∏–∂–µ–Ω–∏–µ: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ –Ω–∞ —á–∞—Å—Ç–∏ –∏ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

3. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å UI**
   - –†–∏—Å–∫: –ó–∞–¥–µ—Ä–∂–∫–∏ UI –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –¥–ª–∏–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
   - –°–Ω–∏–∂–µ–Ω–∏–µ: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞

4. **–ö–∞—á–µ—Å—Ç–≤–æ —Å—É–º–º–∞—Ä–∏–∑–∞—Ü–∏–∏**
   - –†–∏—Å–∫: –ù–µ–∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∏–ª–∏ –Ω–µ—Ç–æ—á–Ω—ã–µ —Å—É–º–º–∞—Ä–∏–∑–∞—Ü–∏–∏
   - –°–Ω–∏–∂–µ–Ω–∏–µ: –¢—â–∞—Ç–µ–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ–º–ø—Ç–æ–≤ –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∏—Ö –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º 